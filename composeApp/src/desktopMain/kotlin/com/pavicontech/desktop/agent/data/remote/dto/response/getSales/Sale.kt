package com.pavicontech.desktop.agent.data.remote.dto.response.getSales

import com.pavicontech.desktop.agent.data.remote.dto.request.createCreditNoteSale.CreditNoteReq
import kotlinx.serialization.ExperimentalSerializationApi
import kotlinx.serialization.Serializable
import kotlinx.serialization.json.JsonIgnoreUnknownKeys

@OptIn(ExperimentalSerializationApi::class)
@JsonIgnoreUnknownKeys
@Serializable
data class Sale(
    val Business: Business,
    val PRINT: String,
    val businessId: Int,
    val cfmDt: String,
    val cnclDt: String? = null,
    val cnclReqDt: String? = null,
    val createdAt: String,
    val curRcptNo: String? = null,
    val custNm: String? = null,
    val custTin: String? = null,
    val deletedAt: String? = null,
    val id: Int,
    val intrlData: String? = null,
    val invcNo: Int,
    val items: List<Item>,
    val long_url: String? = null,
    val orgInvcNo: Int,
    val pmtTyCd: String,
    val prchrAcptcYn: String? = null,
    val rcptSign: String? = null,
    val rcptTyCd: String,
    val receipt: Receipt? = null,
    val remark: String? = null,
    val resultDt: String? = null,
    val rfdDt: String? = null,
    val rfdRsnCd: String? = null,
    val saleReceiptId: Int? = null,
    val salesDt: String,
    val salesSttsCd: String,
    val salesTyCd: String,
    val sdcDateTime: String? = null,
    val short_id: String? = null,
    val short_url: String? = null,
    val status: String,
    val stockRlsDt: String,
    val taxAmtA: String,
    val taxAmtB: String,
    val taxAmtC: String,
    val taxAmtD: String,
    val taxAmtE: String,
    val taxRtA: String,
    val taxRtB: String,
    val taxRtC: String,
    val taxRtD: String,
    val taxRtE: String,
    val taxblAmtA: String,
    val taxblAmtB: String,
    val taxblAmtC: String,
    val taxblAmtD: String,
    val taxblAmtE: String,
    val totAmt: String,
    val totItemCnt: Int,
    val totRcptNo: String? = null,
    val totTaxAmt: String,
    val totTaxblAmt: String,
    val trdInvcNo: Int,
    val updatedAt: String,
    val userId: Int,
)


@OptIn(ExperimentalSerializationApi::class)
@JsonIgnoreUnknownKeys
@Serializable
data class Receipt(
    val id: Int,
    val custTin: Int? = null,
   // val salesDt: String,
    //val salesId: Int,
    //val salesSttsCd: String,
    //val salesTyCd: String,
    //val trdInvcNo: Int,
    //val curRcptNo: String? = null,
    //val rcptSign: String? = null,
    //val rcptTyCd: String,
)

fun Sale.toCrediNoteReq() = CreditNoteReq(
    cfmDt = cfmDt,
    custEmail = custNm ?: "",
    custNm = custNm ?: "",
    custTel = custTin ?: "",
    custTin = custTin ?: "",
    custType = "NEW",
    invcNo = invcNo.toString(),
    itemList = items.map {
        it.toCreditNoteItem()
    },
    modrId = "Admin",
    modrNm = "Admin",
    orgInvcNo = orgInvcNo,
    pmtTyCd = pmtTyCd,
    prchrAcptcYn = prchrAcptcYn ?: "N",
    rcptTyCd = rcptTyCd,
    regrId = "Admin",
    regrNm = "Admin",
    remark = remark ?: "",
    rfdRsnCd = rfdRsnCd ?: "",
    salesDt = salesDt,
    salesSttsCd = salesSttsCd,
    salesTyCd = salesTyCd,
    stockRlsDt = stockRlsDt,
    taxAmtA = taxAmtA.toInt(),
    taxAmtB = taxAmtB.toInt(),
    taxAmtC = taxAmtC.toInt(),
    taxAmtD = taxAmtD.toInt(),
    taxAmtE = taxAmtE.toInt(),
    taxRtA = taxRtA.toInt(),
    taxRtB = taxRtB.toInt(),
    taxRtC = taxRtC.toInt(),
    taxRtD = taxRtD.toInt(),
    taxRtE = taxRtE.toInt(),
    taxblAmtA = taxblAmtA.toInt(),
    taxblAmtB = taxblAmtB.toInt(),
    taxblAmtC = taxblAmtC.toInt(),
    taxblAmtD = taxblAmtD.toInt(),
    taxblAmtE = taxblAmtE.toInt(),
    totAmt = totAmt.toInt(),
    totItemCnt = totItemCnt,
    totTaxAmt = totTaxAmt.toInt(),
    totTaxblAmt = totTaxblAmt.toInt(),
    trdInvcNo = trdInvcNo.toString(),
)